# 基本設定
set-option -g default-shell /bin/zsh
set-option -g default-terminal screen-256color
set -g terminal-overrides 'xterm:colors=256'
set-option -g mouse on
set -g prefix C-b

# 開始番号を 1 に (ウィンドウ・ペイン)
set-option -g base-index 1
set-window-option -g pane-base-index 1

# ステータスライン設定
set-option -g status-interval 1
set-option -g status-justify "centre"
set-option -g status-bg "colour238"
set-option -g status-fg "colour255"
set-option -g status-left "#[fg=colour255,bg=colour241]Session: #S #[default]"

# OSごとのLA表示分岐
if-shell "uname | grep -q Darwin" \
    'set-option -g status-right "#[fg=colour255,bg=colour241] #h | LA: #(sysctl -n vm.loadavg | cut -d\" \" -f2-4) | %m/%d %H:%M:%S#[default]"' \
    'set-option -g status-right "#[fg=colour255,bg=colour241] #h | LA: #(cut -d\" \" -f-3 /proc/loadavg) | %m/%d %H:%M:%S#[default]"'

# キーバインド (Vim風)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R
bind-key r source-file ~/.tmux.conf\; display-message "Reloaded!"

# コピーモード
setw -g mode-keys vi
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy" # Mac用 (Linuxはtpmのyankプラグインで吸収)

# ---------------------------------------------------------
# Tpm Plugins (末尾に配置)
# ---------------------------------------------------------
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @continuum-restore 'on'

run '~/.tmux/plugins/tpm/tpm'